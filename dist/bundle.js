var GalaxyRenderer;GalaxyRenderer=(()=>{"use strict";var t={514:(t,e,r)=>{r.r(e),r.d(e,{galaxy:()=>T,uiController:()=>C});var i,s,a=1e-6,h="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var t=new h(16);return h!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function l(){var t=new h(3);return h!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function o(t,e,r){var i=new h(3);return i[0]=t,i[1]=e,i[2]=r,i}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),l();class g{constructor(t=0,e=0,r=0){this.x=0,this.y=0,this.z=0,this.x=t,this.y=e,this.z=r}}class u{constructor(t=1,e=1,r=1,i=0){this.r=0,this.g=0,this.b=0,this.a=0,this.r=t,this.g=e,this.b=r,this.a=i}}class d{constructor(){this.theta0=0,this.velTheta=0,this.tiltAngle=0,this.a=0,this.b=0,this.temp=0,this.mag=0,this.type=0}}class p{constructor(t,e,r,i,s,a,h,n,l,o,g){this.rad=0,this.radCore=0,this.deltaAng=0,this.ex1=0,this.ex2=0,this.numStars=0,this.hasDarkMatter=!0,this.pertN=0,this.pertAmp=0,this.dustRenderSize=0,this.baseTemp=0,this.rad=t,this.radCore=e,this.deltaAng=r,this.ex1=i,this.ex2=s,this.numStars=a,this.hasDarkMatter=h,this.pertN=n,this.pertAmp=l,this.dustRenderSize=o,this.baseTemp=g}}class b{constructor(){}}class m extends b{constructor(t,e,r,i,s,a,h){super(),this.pos=new g,this.col=new u(0,0,0,0),this.pos.x=t,this.pos.y=e,this.pos.z=r,this.col.r=i,this.col.g=s,this.col.b=a,this.col.a=h}numberOfFloats(){return 7}writeTo(t,e){t[e+0]=this.pos.x,t[e+1]=this.pos.y,t[e+2]=this.pos.z,t[e+3]=this.col.r,t[e+4]=this.col.g,t[e+5]=this.col.b,t[e+6]=this.col.a}}class c extends b{constructor(t,e){super(),this.star=new d,this.col=new u,this.star=t,this.col=e}numberOfFloats(){return 12}writeTo(t,e){t[e+0]=this.star.theta0,t[e+1]=this.star.velTheta,t[e+2]=this.star.tiltAngle,t[e+3]=this.star.a,t[e+4]=this.star.b,t[e+5]=this.star.temp,t[e+6]=this.star.mag,t[e+7]=this.star.type,t[e+8]=this.col.r,t[e+9]=this.col.g,t[e+10]=this.col.b,t[e+11]=this.col.a}}class f{static powerTwoFloor(t){let e=2,r=2*e;for(;(r*=2)<=t;)e<<=1;return e<<1}static rnum(){return Math.random()}static colorFromTemperature(t){let e=Math.floor((t-1e3)/9e3*200);return e=Math.min(199,e),e=Math.max(0,e),[{r:1,g:-.00987248,b:-.0166818,a:1},{r:1,g:671682e-9,b:-.0173831,a:1},{r:1,g:.0113477,b:-.0179839,a:1},{r:1,g:.0221357,b:-.0184684,a:1},{r:1,g:.0330177,b:-.0188214,a:1},{r:1,g:.0439771,b:-.0190283,a:1},{r:1,g:.0549989,b:-.0190754,a:1},{r:1,g:.0660696,b:-.0189496,a:1},{r:1,g:.0771766,b:-.0186391,a:1},{r:1,g:.0883086,b:-.0181329,a:1},{r:1,g:.0994553,b:-.017421,a:1},{r:1,g:.110607,b:-.0164945,a:1},{r:1,g:.121756,b:-.0153455,a:1},{r:1,g:.132894,b:-.0139671,a:1},{r:1,g:.144013,b:-.0123534,a:1},{r:1,g:.155107,b:-.0104993,a:1},{r:1,g:.166171,b:-.0084008,a:1},{r:1,g:.177198,b:-.00605465,a:1},{r:1,g:.188184,b:-.00345843,a:1},{r:1,g:.199125,b:-610485e-9,a:1},{r:1,g:.210015,b:.00249014,a:1},{r:1,g:.220853,b:.00584373,a:1},{r:1,g:.231633,b:.00944995,a:1},{r:1,g:.242353,b:.0133079,a:1},{r:1,g:.25301,b:.0174162,a:1},{r:1,g:.263601,b:.021773,a:1},{r:1,g:.274125,b:.0263759,a:1},{r:1,g:.284579,b:.0312223,a:1},{r:1,g:.294962,b:.0363091,a:1},{r:1,g:.305271,b:.0416328,a:1},{r:1,g:.315505,b:.0471899,a:1},{r:1,g:.325662,b:.0529765,a:1},{r:1,g:.335742,b:.0589884,a:1},{r:1,g:.345744,b:.0652213,a:1},{r:1,g:.355666,b:.0716707,a:1},{r:1,g:.365508,b:.078332,a:1},{r:1,g:.375268,b:.0852003,a:1},{r:1,g:.384948,b:.0922709,a:1},{r:1,g:.394544,b:.0995389,a:1},{r:1,g:.404059,b:.106999,a:1},{r:1,g:.41349,b:.114646,a:1},{r:1,g:.422838,b:.122476,a:1},{r:1,g:.432103,b:.130482,a:1},{r:1,g:.441284,b:.138661,a:1},{r:1,g:.450381,b:.147005,a:1},{r:1,g:.459395,b:.155512,a:1},{r:1,g:.468325,b:.164175,a:1},{r:1,g:.477172,b:.172989,a:1},{r:1,g:.485935,b:.181949,a:1},{r:1,g:.494614,b:.19105,a:1},{r:1,g:.503211,b:.200288,a:1},{r:1,g:.511724,b:.209657,a:1},{r:1,g:.520155,b:.219152,a:1},{r:1,g:.528504,b:.228769,a:1},{r:1,g:.536771,b:.238502,a:1},{r:1,g:.544955,b:.248347,a:1},{r:1,g:.553059,b:.2583,a:1},{r:1,g:.561082,b:.268356,a:1},{r:1,g:.569024,b:.27851,a:1},{r:1,g:.576886,b:.288758,a:1},{r:1,g:.584668,b:.299095,a:1},{r:1,g:.592372,b:.309518,a:1},{r:1,g:.599996,b:.320022,a:1},{r:1,g:.607543,b:.330603,a:1},{r:1,g:.615012,b:.341257,a:1},{r:1,g:.622403,b:.35198,a:1},{r:1,g:.629719,b:.362768,a:1},{r:1,g:.636958,b:.373617,a:1},{r:1,g:.644122,b:.384524,a:1},{r:1,g:.65121,b:.395486,a:1},{r:1,g:.658225,b:.406497,a:1},{r:1,g:.665166,b:.417556,a:1},{r:1,g:.672034,b:.428659,a:1},{r:1,g:.678829,b:.439802,a:1},{r:1,g:.685552,b:.450982,a:1},{r:1,g:.692204,b:.462196,a:1},{r:1,g:.698786,b:.473441,a:1},{r:1,g:.705297,b:.484714,a:1},{r:1,g:.711739,b:.496013,a:1},{r:1,g:.718112,b:.507333,a:1},{r:1,g:.724417,b:.518673,a:1},{r:1,g:.730654,b:.53003,a:1},{r:1,g:.736825,b:.541402,a:1},{r:1,g:.742929,b:.552785,a:1},{r:1,g:.748968,b:.564177,a:1},{r:1,g:.754942,b:.575576,a:1},{r:1,g:.760851,b:.586979,a:1},{r:1,g:.766696,b:.598385,a:1},{r:1,g:.772479,b:.609791,a:1},{r:1,g:.778199,b:.621195,a:1},{r:1,g:.783858,b:.632595,a:1},{r:1,g:.789455,b:.643989,a:1},{r:1,g:.794991,b:.655375,a:1},{r:1,g:.800468,b:.666751,a:1},{r:1,g:.805886,b:.678116,a:1},{r:1,g:.811245,b:.689467,a:1},{r:1,g:.816546,b:.700803,a:1},{r:1,g:.82179,b:.712122,a:1},{r:1,g:.826976,b:.723423,a:1},{r:1,g:.832107,b:.734704,a:1},{r:1,g:.837183,b:.745964,a:1},{r:1,g:.842203,b:.757201,a:1},{r:1,g:.847169,b:.768414,a:1},{r:1,g:.852082,b:.779601,a:1},{r:1,g:.856941,b:.790762,a:1},{r:1,g:.861748,b:.801895,a:1},{r:1,g:.866503,b:.812999,a:1},{r:1,g:.871207,b:.824073,a:1},{r:1,g:.87586,b:.835115,a:1},{r:1,g:.880463,b:.846125,a:1},{r:1,g:.885017,b:.857102,a:1},{r:1,g:.889521,b:.868044,a:1},{r:1,g:.893977,b:.878951,a:1},{r:1,g:.898386,b:.889822,a:1},{r:1,g:.902747,b:.900657,a:1},{r:1,g:.907061,b:.911453,a:1},{r:1,g:.91133,b:.922211,a:1},{r:1,g:.915552,b:.932929,a:1},{r:1,g:.91973,b:.943608,a:1},{r:1,g:.923863,b:.954246,a:1},{r:1,g:.927952,b:.964842,a:1},{r:1,g:.931998,b:.975397,a:1},{r:1,g:.936001,b:.985909,a:1},{r:1,g:.939961,b:.996379,a:1},{r:.993241,g:.9375,b:1,a:1},{r:.983104,g:.931743,b:1,a:1},{r:.973213,g:.926103,b:1,a:1},{r:.963562,g:.920576,b:1,a:1},{r:.954141,g:.915159,b:1,a:1},{r:.944943,g:.909849,b:1,a:1},{r:.935961,g:.904643,b:1,a:1},{r:.927189,g:.899538,b:1,a:1},{r:.918618,g:.894531,b:1,a:1},{r:.910244,g:.88962,b:1,a:1},{r:.902059,g:.884801,b:1,a:1},{r:.894058,g:.880074,b:1,a:1},{r:.886236,g:.875434,b:1,a:1},{r:.878586,g:.87088,b:1,a:1},{r:.871103,g:.86641,b:1,a:1},{r:.863783,g:.862021,b:1,a:1},{r:.856621,g:.857712,b:1,a:1},{r:.849611,g:.853479,b:1,a:1},{r:.84275,g:.849322,b:1,a:1},{r:.836033,g:.845239,b:1,a:1},{r:.829456,g:.841227,b:1,a:1},{r:.823014,g:.837285,b:1,a:1},{r:.816705,g:.83341,b:1,a:1},{r:.810524,g:.829602,b:1,a:1},{r:.804468,g:.825859,b:1,a:1},{r:.798532,g:.82218,b:1,a:1},{r:.792715,g:.818562,b:1,a:1},{r:.787012,g:.815004,b:1,a:1},{r:.781421,g:.811505,b:1,a:1},{r:.775939,g:.808063,b:1,a:1},{r:.770561,g:.804678,b:1,a:1},{r:.765287,g:.801348,b:1,a:1},{r:.760112,g:.798071,b:1,a:1},{r:.755035,g:.794846,b:1,a:1},{r:.750053,g:.791672,b:1,a:1},{r:.745164,g:.788549,b:1,a:1},{r:.740364,g:.785474,b:1,a:1},{r:.735652,g:.782448,b:1,a:1},{r:.731026,g:.779468,b:1,a:1},{r:.726482,g:.776534,b:1,a:1},{r:.722021,g:.773644,b:1,a:1},{r:.717638,g:.770798,b:1,a:1},{r:.713333,g:.767996,b:1,a:1},{r:.709103,g:.765235,b:1,a:1},{r:.704947,g:.762515,b:1,a:1},{r:.700862,g:.759835,b:1,a:1},{r:.696848,g:.757195,b:1,a:1},{r:.692902,g:.754593,b:1,a:1},{r:.689023,g:.752029,b:1,a:1},{r:.685208,g:.749502,b:1,a:1},{r:.681458,g:.747011,b:1,a:1},{r:.67777,g:.744555,b:1,a:1},{r:.674143,g:.742134,b:1,a:1},{r:.670574,g:.739747,b:1,a:1},{r:.667064,g:.737394,b:1,a:1},{r:.663611,g:.735073,b:1,a:1},{r:.660213,g:.732785,b:1,a:1},{r:.656869,g:.730528,b:1,a:1},{r:.653579,g:.728301,b:1,a:1},{r:.65034,g:.726105,b:1,a:1},{r:.647151,g:.723939,b:1,a:1},{r:.644013,g:.721801,b:1,a:1},{r:.640922,g:.719692,b:1,a:1},{r:.637879,g:.717611,b:1,a:1},{r:.634883,g:.715558,b:1,a:1},{r:.631932,g:.713531,b:1,a:1},{r:.629025,g:.711531,b:1,a:1},{r:.626162,g:.709557,b:1,a:1},{r:.623342,g:.707609,b:1,a:1},{r:.620563,g:.705685,b:1,a:1},{r:.617825,g:.703786,b:1,a:1},{r:.615127,g:.701911,b:1,a:1},{r:.612469,g:.70006,b:1,a:1},{r:.609848,g:.698231,b:1,a:1},{r:.607266,g:.696426,b:1,a:1},{r:.60472,g:.694643,b:1,a:1}][e]}static velocityWithDarkMatter(t){if(0==t)return 0;let e=f.massHalo(t),r=f.massDisc(t);return 2e4*Math.sqrt(f.CONTANT_OF_GRAVITY*(e+r+100)/t)}static velocityWithoutDarkMatter(t){return 0==t?0:2e4*Math.sqrt(f.CONTANT_OF_GRAVITY*(f.massDisc(t)+100)/t)}static massDisc(t){return 1*Math.exp(-t/2e3)*(t*t)*Math.PI*2e3}static massHalo(t){return.15/(1+Math.pow(t/2500,2))*(4*Math.PI*Math.pow(t,3)/3)}}f.PC_TO_KM=30856775812900,f.SEC_PER_YEAR=31557600,f.DEG_TO_RAD=Math.PI/180,f.RAD_TO_DEG=180/Math.PI,f.CONTANT_OF_GRAVITY=6672e-14;class y{constructor(t=0,e=0,r=0){this.attribIdx=0,this.size=0,this.offset=0,this.attribIdx=t,this.size=e,this.offset=r}}class v{constructor(t,e){this.vbo=null,this.ibo=null,this.vao=null,this.vert=[],this.idx=[],this.shaderProgram=null,this._primitiveType=0,this.bufferMode=0,this.attributes=[],this.gl=t,this.bufferMode=e}defineAttributes(t){this.attributes=[];for(let e=0;e<t.length;++e)this.attributes.push(t[e])}get primitiveType(){return this._primitiveType}set primitiveType(t){this._primitiveType=t}get arrayElementCount(){return this.idx.length}get vertexArrayObject(){if(null==this.vao)throw Error("VertexBufferBase.vertexArrayObject(): vertex array object is null!");return this.vao}createShader(t,e){let r=this.gl.createShader(t);if(this.gl.shaderSource(r,e),this.gl.compileShader(r),!this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)){let e=this.gl.getShaderInfoLog(r);throw this.gl.deleteShader(r),t==this.gl.VERTEX_SHADER?new Error("VertexBuffer: Vertex shader compilation failed: "+e):new Error("VertexBuffer: Fragment shader compilation failed: "+e)}return r}initialize(){this.vbo=this.gl.createBuffer(),this.ibo=this.gl.createBuffer(),this.vao=this.gl.createVertexArray();let t=this.getVertexShaderSource(),e=this.createShader(this.gl.VERTEX_SHADER,t),r=this.getFragmentShaderSource(),i=this.createShader(this.gl.FRAGMENT_SHADER,r);if(this.shaderProgram=this.gl.createProgram(),null==this.shaderProgram)throw new Error("VertexBufferBase.initialize(): shaderProgram cannot be created!");if(this.gl.attachShader(this.shaderProgram,e),this.gl.attachShader(this.shaderProgram,i),this.gl.linkProgram(this.shaderProgram),!this.gl.getProgramParameter(this.shaderProgram,this.gl.LINK_STATUS)){let t=this.gl.getProgramInfoLog(this.shaderProgram);throw this.gl.deleteProgram(this.shaderProgram),this.gl.deleteShader(e),this.gl.deleteShader(i),new Error("VertexBufferBase.initialize():: shader program linking failed!\r\n"+t)}this.gl.detachShader(this.shaderProgram,e),this.gl.detachShader(this.shaderProgram,i)}releaseAttribArray(){for(let t=0;t<this.attributes.length;++t){let e=this.attributes[t].attribIdx;this.gl.disableVertexAttribArray(e)}}release(){this.releaseAttribArray(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,0),this.gl.bindVertexArray(null),null!=this.vbo&&this.gl.deleteBuffer(this.vbo),null!=this.ibo&&this.gl.deleteBuffer(this.ibo),null!=this.vao&&this.gl.deleteVertexArray(this.vao)}onSetCustomShaderVariables(){}onBeforeDraw(){}draw(t,e){if(null==this.shaderProgram)throw new Error("VertexBufferBase.draw(): shader program is null!");this.gl.useProgram(this.shaderProgram);let r=this.gl.getUniformLocation(this.shaderProgram,"viewMat");this.gl.uniformMatrix4fv(r,!1,t);let i=this.gl.getUniformLocation(this.shaderProgram,"projMat");this.gl.uniformMatrix4fv(i,!1,e),this.onSetCustomShaderVariables(),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE),this.gl.blendEquation(this.gl.FUNC_ADD),this.onBeforeDraw(),this.gl.bindVertexArray(this.vao),this.gl.drawElements(this.primitiveType,this.idx.length,this.gl.UNSIGNED_INT,0),this.gl.bindVertexArray(null),this.gl.disable(this.gl.BLEND),this.gl.useProgram(null)}createBuffer(t,e,r){if(0==t.length)throw Error("VertexBufferBase.createBuffer: vertex array size is 0!");if(0==e.length)throw Error("VertexBufferBase.createBuffer: index array size is 0!");this.vert=t,this.idx=e,this.primitiveType=r;let i=t[0].numberOfFloats(),s=new Float32Array(t.length*i);for(let e=0;e<t.length;++e)t[e].writeTo(s,e*i);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.bufferMode),this.gl.bindVertexArray(this.vao),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.ibo),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vbo),this.attributes.forEach((t=>{this.gl.enableVertexAttribArray(t.attribIdx),this.gl.vertexAttribPointer(t.attribIdx,t.size,this.gl.FLOAT,!1,4*i,t.offset)})),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.ibo);let a=new Uint32Array(e.length);for(let t=0;t<e.length;++t)a[t]=e[t];this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,a,this.gl.STATIC_DRAW);let h=this.gl.getError();if(h!=this.gl.NO_ERROR)throw Error("VertexBufferBase: Cannot create vbo! (Error "+h+")");this.gl.bindVertexArray(null)}}class x extends v{constructor(t,e,r){super(t,r),this.lineWidth=1,this.attPosition=0,this.attColor=1,this.lineWidth=e,this.defineAttributes([new y(this.attPosition,3,0),new y(this.attColor,4,12)])}onBeforeDraw(){this.gl.lineWidth(this.lineWidth)}getVertexShaderSource(){return"#version 300 es\n\nprecision mediump float;\n\nuniform mat4 projMat;\nuniform mat4 viewMat;\n\nlayout(location = 0) in vec3 position;\nlayout(location = 1) in vec4 color;\n\nout vec4 vertexColor;\n\nvoid main()\n{\n\tgl_Position =  projMat * vec4(position, 1);\n\tgl_PointSize = 2.0;\n\tvertexColor = color;\n}"}getFragmentShaderSource(){return"#version 300 es \n\nprecision mediump float;\n\nout vec4 FragColor;\n\nin vec4 vertexColor;\n\nvoid main()\n{\n\tFragColor = vertexColor;\n}"}}class _ extends v{constructor(t){super(t,t.STATIC_DRAW),this.pertN=0,this.dustSize=0,this.pertAmp=0,this.time=0,this.blendFunc=0,this.blendEquation=0,this.displayFeatures=0,this.attTheta0=0,this.attVelTheta=1,this.attTiltAngle=2,this.attSemiMajorAxis=3,this.attSemiMinorAxis=4,this.attTemperature=5,this.attMagnitude=6,this.attType=7,this.attColor=8,this.blendFunc=this.gl.ONE,this.blendEquation=this.gl.FUNC_ADD,this.defineAttributes([new y(this.attTheta0,1,0),new y(this.attVelTheta,1,4),new y(this.attTiltAngle,1,8),new y(this.attSemiMajorAxis,1,12),new y(this.attSemiMinorAxis,1,16),new y(this.attTemperature,1,20),new y(this.attMagnitude,1,24),new y(this.attType,1,28),new y(this.attColor,4,32)])}updateShaderVariables(t,e,r,i,s){this.pertN=e,this.pertAmp=r,this.time=t,this.dustSize=i,this.displayFeatures=s}getVertexShaderSource(){return"#version 300 es\n\n#define DEG_TO_RAD 0.01745329251\n\nuniform mat4 projMat;\nuniform mat4 viewMat;\n\nuniform int pertN;\nuniform int dustSize;\nuniform int displayFeatures;\nuniform float pertAmp;\nuniform float time;\n\nlayout(location = 0) in float theta0;\nlayout(location = 1) in float velTheta;\nlayout(location = 2) in float tiltAngle;\nlayout(location = 3) in float a;\nlayout(location = 4) in float b;\nlayout(location = 5) in float temp;\nlayout(location = 6) in float mag;\nlayout(location = 7) in float type;\nlayout(location = 8) in vec4 color;\n\nout vec4 vertexColor;\n\nout float vertexType;\nflat out int features;\n\nvec2 calcPos(float a, float b, float theta, float velTheta, float time, float tiltAngle) {\n    float thetaActual = theta + velTheta * time;\n    float beta = -tiltAngle;\n    float alpha = thetaActual * DEG_TO_RAD;\n    float cosalpha = cos(alpha);\n    float sinalpha = sin(alpha);\n    float cosbeta = cos(beta);\n    float sinbeta = sin(beta);\n    vec2 center = vec2(0,0);\n    vec2 ps = vec2(center.x + (a * cosalpha * cosbeta - b * sinalpha * sinbeta),\n                   center.y + (a * cosalpha * sinbeta + b * sinalpha * cosbeta));\n    if (pertAmp > 0.0 && pertN > 0) {\n        ps.x += (a / pertAmp) * sin(alpha * 2.0 * float(pertN));\n        ps.y += (a / pertAmp) * cos(alpha * 2.0 * float(pertN));\n    }\nreturn ps;\n}\n\nvoid main()\n{\n    vec2 ps = calcPos(a, b, theta0, velTheta, time, tiltAngle);\n\n    if (type==0.0) {\n        gl_PointSize = mag * 4.0;\n        vertexColor = color * mag;\n    } else if (type==1.0) {\t\n        gl_PointSize = mag * 5.0 * float(dustSize);\n        vertexColor = color * mag;\n    } else if (type==2.0) {\n        gl_PointSize = mag * 2.0 * float(dustSize);\n        vertexColor = color * mag;\n    } else if (type==3.0) {\n        vec2 ps2 = calcPos(a + 1000.0, b, theta0, velTheta, time, tiltAngle);\n        float dst = distance(ps, ps2);\n        float size = ((1000.0 - dst) / 10.0) - 50.0;\n        gl_PointSize = size;\n        vertexColor = color * mag * vec4(2.0, 0.5, 0.5, 1.0);\n    } else if (type==4.0) {\n        vec2 ps2 = calcPos(a + 1000.0, b, theta0, velTheta, time, tiltAngle);\n        float dst = distance(ps, ps2);\n        float size = ((1000.0 - dst) / 10.0) - 50.0;\n        gl_PointSize = size/10.0;\n        vertexColor = vec4(1.0,1.0,1.0,1.0);\n    }\n    gl_Position =  projMat * vec4(ps, 0.0, 1.0);\n    vertexType = type;\n    features = displayFeatures;\n}"}getFragmentShaderSource(){return"#version 300 es\n\nprecision mediump float;\n\nin vec4 vertexColor;\n\nin float vertexType;\nflat in int features;\n\nout vec4 FragColor;\n\nvoid main()\n{\n    if (vertexType==0.0) {\n        if ( (features & 1) ==0)\n            discard;\n        FragColor = vertexColor;\n        vec2 circCoord = 2.0 * gl_PointCoord - 1.0;\n        float alpha = 1.0 - length(circCoord);\n        FragColor = vec4(vertexColor.xyz, alpha);\n    } else if (vertexType==1.0) {\n        if ( (features & 2) ==0)\n            discard;\n        vec2 circCoord = 2.0 * gl_PointCoord - 1.0;\n        float alpha = 0.05 * (1.0 - length(circCoord));\n        FragColor = vec4(vertexColor.xyz, alpha);\n    } else if (vertexType==2.0) {\n        if ( (features & 4) ==0)\n            discard;\n        vec2 circCoord = 2.0 * gl_PointCoord - 1.0;\n        float alpha = 0.07 * (1.0 - length(circCoord));\n        FragColor = vec4(vertexColor.xyz, alpha);\n    } else if (vertexType==3.0) {\n        if ((features & 8) == 0)\n            discard;\n        vec2 circCoord = 2.0 * gl_PointCoord - 1.0;\n        float alpha = 1.0 - length(circCoord);\n        FragColor = vec4(vertexColor.xyz, alpha);\n    } else if (vertexType==4.0) {\n        if ((features & 8)== 0)\n            discard;\n        vec2 circCoord = 2.0 * gl_PointCoord - 1.0;\n        float alpha = 1.0 - length(circCoord);\n        FragColor = vec4(vertexColor.xyz, alpha);\n    }\n}"}onSetCustomShaderVariables(){if(null==this.shaderProgram)throw new Error("onSetCustomShaderVariables(): Shader program is null!");let t=this.gl.getUniformLocation(this.shaderProgram,"dustSize");this.gl.uniform1i(t,this.dustSize);let e=this.gl.getUniformLocation(this.shaderProgram,"pertN");this.gl.uniform1i(e,this.pertN);let r=this.gl.getUniformLocation(this.shaderProgram,"pertAmp");this.gl.uniform1f(r,this.pertAmp);let i=this.gl.getUniformLocation(this.shaderProgram,"time");this.gl.uniform1f(i,this.time);let s=this.gl.getUniformLocation(this.shaderProgram,"displayFeatures");this.gl.uniform1i(s,this.displayFeatures)}draw(t,e){if(null==this.shaderProgram)throw new Error("draw(...): Shader program is null!");this.gl.useProgram(this.shaderProgram);let r=this.gl.getUniformLocation(this.shaderProgram,"viewMat");this.gl.uniformMatrix4fv(r,!1,t);let i=this.gl.getUniformLocation(this.shaderProgram,"projMat");this.gl.uniformMatrix4fv(i,!1,e),this.onSetCustomShaderVariables(),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.blendFunc),this.gl.blendEquation(this.blendEquation),this.onBeforeDraw(),this.gl.bindVertexArray(this.vertexArrayObject),this.gl.drawElements(this.primitiveType,this.arrayElementCount,this.gl.UNSIGNED_INT,0),this.gl.bindVertexArray(null),this.gl.disable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.useProgram(null)}}class S{constructor(){this.min=0,this.max=0,this.width=0,this.steps=0,this.i0=0,this.k=0,this.a=0,this.r_bulge=0,this.m1=[],this.y1=[],this.x1=[],this.m2=[],this.y2=[],this.x2=[]}probFromVal(t){if(t<this.min||t>this.max)throw new Error("out of range");let e=(this.max-this.min)/this.steps*2,r=(t-this.min)/e,i=t-r*e;return this.y1[r]+this.m1[r]*i}valFromProb(t){if(t<0||t>1)throw new Error("out of range");let e=1/(this.y2.length-1),r=Math.floor(t/e),i=t-r*e;return this.y2[r]+this.m2[r]*i}setupRealistic(t,e,r,i,s,a,h){this.min=s,this.max=a,this.steps=h,this.i0=t,this.k=e,this.a=r,this.r_bulge=i,this.buildCdf(h)}buildCdf(t){let e=(this.max-this.min)/this.steps,r=0,i=0;this.x1=[],this.y1=[],this.x2=[],this.y2=[],this.m1=[],this.m2=[],this.y1.push(0),this.x1.push(0);for(let t=0;t<this.steps;t+=2)r=e*(t+2),i+=e/3*(this.intensity(this.min+t*e)+4*this.intensity(this.min+(t+1)*e)+this.intensity(this.min+(t+2)*e)),this.m1.push((i-this.y1[this.y1.length-1])/(2*e)),this.x1.push(r),this.y1.push(i);if(this.m1.push(0),this.m1.length!=this.x1.length||this.m1.length!=this.y1.length)throw new Error("CumulativeDistributionFunction::BuildCDF: array size mismatch (1)!");for(let t=0;t<this.y1.length;++t)this.y1[t]/=this.y1[this.y1.length-1],this.m1[t]/=this.y1[this.y1.length-1];this.x2.push(0),this.y2.push(0);let s=0;e=1/t;for(let r=1,a=0;r<t;++r){for(s=r*e;this.y1[a+1]<=s;++a);i=this.x1[a]+(s-this.y1[a])/this.m1[a],this.m2.push((i-this.y2[this.y2.length-1])/e),this.x2.push(s),this.y2.push(i)}if(this.m2.push(0),this.m2.length!=this.x2.length||this.m2.length!=this.y2.length)throw new Error("CumulativeDistributionFunction::BuildCDF: array size mismatch (1)!")}intensityBulge(t,e,r){return e*Math.exp(-r*Math.pow(t,.25))}intensityDisc(t,e,r){return e*Math.exp(-t/r)}intensity(t){return t<this.r_bulge?this.intensityBulge(t,this.i0,this.k):this.intensityDisc(t-this.r_bulge,this.intensityBulge(this.r_bulge,this.i0,this.k),this.a)}}class A{constructor(t=15e3,e=6e3,r=.019,i=.8,s=1,a=6e4){this._stars=[],this._elEx1=0,this._elEx2=0,this._angleOffset=0,this._radCore=0,this._radGalaxy=0,this._radFarField=0,this._dustRenderSize=0,this._numStars=0,this._numH2=0,this._pertN=0,this._pertAmp=0,this._hasDarkMatter=!0,this._baseTemp=0,this._elEx1=i,this._elEx2=s,this._angleOffset=r,this._radCore=e,this._radGalaxy=t,this._radFarField=2*t,this._numStars=a,this._numH2=400,this._pertN=0,this._pertAmp=0,this._hasDarkMatter=!0,this._baseTemp=4e3,this._stars=[],this._dustRenderSize=70}initStarsAndDust(){this._stars=[],this._stars.push({a:0,b:0,tiltAngle:0,theta0:0,velTheta:0,type:0,temp:6e3,mag:1});let t=new S;t.setupRealistic(1,.02,this._radGalaxy/3,this._radCore,0,this._radFarField,1e3);for(let e=1;e<this._numStars;++e){let r=t.valFromProb(f.rnum()),i=new d;i.a=r,i.b=r*this.getExcentricity(r),i.tiltAngle=this.getAngularOffset(r),i.theta0=360*f.rnum(),i.velTheta=this.getOrbitalVelocity(r),i.temp=4e3*f.rnum()-2e3+6e3,i.mag=.1+.4*f.rnum(),i.type=0,e<this._numStars/60&&(i.mag=Math.min(i.mag+.1+.4*f.rnum(),1)),this._stars.push(i)}let e=0,r=0,i=0;for(let s=0;s<this._numStars;++s){s%2==0?i=t.valFromProb(f.rnum()):(e=2*this._radGalaxy*f.rnum()-this._radGalaxy,r=2*this._radGalaxy*f.rnum()-this._radGalaxy,i=Math.sqrt(e*e+r*r));let a=new d;a.a=i,a.b=i*this.getExcentricity(i),a.tiltAngle=this.getAngularOffset(i),a.theta0=360*f.rnum(),a.velTheta=this.getOrbitalVelocity((a.a+a.b)/2),a.type=1,a.temp=this._baseTemp+i/4.5,a.mag=.02+.15*f.rnum(),this._stars.push(a)}for(let s=0;s<this._numStars/100;++s){i=t.valFromProb(f.rnum()),e=2*this._radGalaxy*f.rnum()-this._radGalaxy,r=2*this._radGalaxy*f.rnum()-this._radGalaxy,i=Math.sqrt(e*e+r*r);let s=360*f.rnum(),a=.1+.05*f.rnum(),h=100*f.rnum();for(let t=0;t<h;++t){i=i+200-400*f.rnum();let t=new d;t.a=i,t.b=i*this.getExcentricity(i),t.tiltAngle=this.getAngularOffset(i),t.theta0=s+10-20*f.rnum(),t.velTheta=this.getOrbitalVelocity((t.a+t.b)/2),t.temp=this._baseTemp+i/4.5-1e3,t.mag=a+.025*f.rnum(),t.type=2,this._stars.push(t)}}for(let t=0;t<this._numH2;++t){e=2*this._radGalaxy*f.rnum()-this._radGalaxy,r=2*this._radGalaxy*f.rnum()-this._radGalaxy,i=Math.sqrt(e*e+r*r);let t=new d;t.a=i,t.b=i*this.getExcentricity(i),t.tiltAngle=this.getAngularOffset(i),t.theta0=360*f.rnum(),t.velTheta=this.getOrbitalVelocity((t.a+t.b)/2),t.temp=6e3+6e3*f.rnum()-3e3,t.mag=.1+.05*f.rnum(),t.type=3,this._stars.push(t);let s=new d;s.a=t.a,s.b=t.b,s.tiltAngle=t.tiltAngle,s.theta0=t.theta0,s.velTheta=t.velTheta,s.temp=t.temp,s.mag=t.mag,s.type=4,this._stars.push(s)}}reset(t=null,e){null!=t&&(this._baseTemp=t.baseTemp,this._elEx1=t.ex1,this._elEx2=t.ex2,this._elEx2=t.ex2,this._angleOffset=t.deltaAng,this._radCore=t.radCore,this._radGalaxy=t.rad,this._radFarField=2*t.rad,this._numStars=t.numStars,this._dustRenderSize=t.dustRenderSize,this._hasDarkMatter=t.hasDarkMatter,this._pertN=t.pertN,this._pertAmp=t.pertAmp),e&&this.initStarsAndDust()}get stars(){return this._stars}get rad(){return this._radGalaxy}set rad(t){this._radGalaxy=t,this._radFarField=2*t}get coreRad(){return this._radCore}set coreRad(t){this._radCore=t}get farFieldRad(){return this._radFarField}getExcentricity(t){return t<this._radCore?1+t/this._radCore*(this._elEx1-1):t>this._radCore&&t<=this._radGalaxy?this._elEx1+(t-this._radCore)/(this._radGalaxy-this._radCore)*(this._elEx2-this._elEx1):t>this._radGalaxy&&t<this._radFarField?this._elEx2+(t-this._radGalaxy)/(this._radFarField-this._radGalaxy)*(1-this._elEx2):1}getOrbitalVelocity(t){let e=0;return e=this._hasDarkMatter?f.velocityWithDarkMatter(t):f.velocityWithoutDarkMatter(t),360/(2*Math.PI*t*f.PC_TO_KM/(e*f.SEC_PER_YEAR))}getAngularOffset(t){return t*this._angleOffset}get angleOffset(){return this._angleOffset}set angleOffset(t){this._angleOffset=t}get exInner(){return this._elEx1}set exInner(t){this._elEx1=t}get exOuter(){return this._elEx2}set exOuter(t){this._elEx2=t}get dustRenderSize(){return this._dustRenderSize}set dustRenderSize(t){this._dustRenderSize=t}get pertN(){return this._pertN}set pertN(t){this._pertN=t}get pertAmp(){return this._pertAmp}set pertAmp(t){this._pertAmp=t}get baseTemp(){return this._baseTemp}set baseTemp(t){this._baseTemp=t}get hasDarkMatter(){return this._hasDarkMatter}set hasDarkMatter(t){this._hasDarkMatter=t,this.initStarsAndDust()}}
